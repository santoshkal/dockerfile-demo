# STAGE 0
  # Dockerfile generated by Genval
  # Uses Chainguard's distroless wolfi as base image
  FROM cgr.dev/chainguard/wolfi-base AS build
  ENV APP_HOME=/app
  WORKDIR $APP_HOME
  RUN apk --no-cache update && apk add dotnet-7-sdk
  COPY . .
  RUN dotnet restore --no-cache ./Application/Application.csproj
  RUN dotnet build --configuration Release -o out
  RUN dotnet publish -c Release --use-current-runtime --self-contained false -o out

# STAGE 1
  FROM cgr.dev/chainguard/wolfi-base As Final
  RUN apk --no-cache update && apk add dotnet-7-sdk \
      && apk add dotnet-7-runtime
  ENV APP_HOME=/app
  WORKDIR $APP_HOME
  COPY --from=build /app/out/ .
  USER nonroot
  EXPOSE 80
  ENTRYPOINT ["dotnet", "./AuthorService.dll"]
